<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare Pages 部署指南 - Home Voice Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        .code-block code {
            color: #e2e8f0;
        }
        .section {
            scroll-margin-top: 2rem;
        }
        .docs-layout {
            display: grid;
            grid-template-columns: 250px 1fr 200px;
            gap: 2rem;
            min-height: calc(100vh - 64px);
        }
        @media (max-width: 1024px) {
            .docs-layout {
                grid-template-columns: 200px 1fr;
            }
            .toc-right {
                display: none;
            }
        }
        @media (max-width: 768px) {
            .docs-layout {
                grid-template-columns: 1fr;
            }
            .toc-left, .toc-right {
                display: none;
            }
        }
        .toc-left {
            position: sticky;
            top: 4rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }
        .toc-right {
            position: sticky;
            top: 4rem;
            height: fit-content;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="/" class="text-xl font-bold text-gray-800 hover:text-blue-600">Home Voice Box</a>
                <div class="hidden md:flex space-x-4">
                    <a href="/" class="text-gray-600 hover:text-blue-600">文档</a>
                    <a href="https://github.com/xinFengQi/ds-voice-box" target="_blank" class="text-gray-600 hover:text-blue-600">GitHub</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- 三栏布局 -->
    <div class="docs-layout container mx-auto px-4 py-8">
        <!-- 左侧目录 -->
        <aside class="toc-left bg-white rounded-lg shadow p-4">
            <h3 class="font-bold text-gray-800 mb-4">文档目录</h3>
            <nav class="space-y-2">
                <a href="/" class="block text-gray-700 hover:text-blue-600">首页</a>
                <a href="/docs/home-assistant.html" class="block text-gray-700 hover:text-blue-600">Home Assistant 部署</a>
                <a href="/docs/cloudflare-tunnel.html" class="block text-gray-700 hover:text-blue-600">Cloudflare Tunnel</a>
                <a href="/docs/cloudflare-pages.html" class="block text-blue-600 font-medium">Cloudflare Pages 部署</a>
                <a href="/docs/configuration.html" class="block text-gray-700 hover:text-blue-600">配置指南</a>
                <a href="/docs/usage.html" class="block text-gray-700 hover:text-blue-600">使用指南</a>
                <a href="/docs/api.html" class="block text-gray-700 hover:text-blue-600">API 文档</a>
            </nav>
        </aside>

        <!-- 中间内容 -->
        <main class="max-w-4xl">
            <div class="bg-white rounded-lg shadow p-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-6">Cloudflare Pages 部署指南</h1>
                
                <div class="prose max-w-none">
                    <p class="text-lg text-gray-700 mb-6">
                        Cloudflare Pages 是一个现代化的静态网站和全栈应用托管平台。本指南将帮助你部署 Home Voice Box 项目。
                    </p>

                    <section id="overview" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">概述</h2>
                        <p class="text-gray-700 mb-4">
                            Cloudflare Pages 支持：
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>自动从 Git 仓库部署</li>
                            <li>预览部署（每个 Pull Request）</li>
                            <li>无限带宽和请求</li>
                            <li>全球 CDN 加速</li>
                            <li>Serverless Functions 支持</li>
                        </ul>
                        <p class="text-gray-700 mb-4 mt-4">
                            参考文档：
                            <a href="https://developers.cloudflare.com/pages/" target="_blank" class="text-blue-600 hover:underline">
                                Cloudflare Pages 官方文档
                            </a>
                        </p>
                    </section>

                    <section id="prerequisites" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">前置要求</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>Cloudflare 账户（免费账户即可）</li>
                            <li>GitHub、GitLab 或 Bitbucket 账户</li>
                            <li>已准备好部署的项目代码</li>
                        </ul>
                    </section>

                    <section id="prepare-repo" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">准备 Git 仓库</h2>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">1. Fork 或克隆项目</h3>
                        <div class="code-block mb-4">
                            <code># Fork 项目到你的 GitHub 账户<br># 或克隆项目<br>git clone https://github.com/xinFengQi/ds-voice-box.git<br>cd ds-voice-box</code>
                        </div>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">2. 推送到你的仓库</h3>
                        <div class="code-block mb-4">
                            <code># 添加你的远程仓库<br>git remote add origin https://github.com/your-username/ds-voice-box.git<br><br># 推送代码<br>git push -u origin main</code>
                        </div>
                    </section>

                    <section id="create-project" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">创建 Pages 项目</h2>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">1. 登录 Cloudflare Dashboard</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>访问 <a href="https://dash.cloudflare.com/" target="_blank" class="text-blue-600 hover:underline">Cloudflare Dashboard</a></li>
                            <li>登录你的账户</li>
                        </ol>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">2. 创建 Pages 项目</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>在左侧菜单选择 <strong>Workers & Pages</strong></li>
                            <li>点击 <strong>Create application</strong></li>
                            <li>选择 <strong>Pages</strong> 标签</li>
                            <li>点击 <strong>Connect to Git</strong></li>
                            <li>选择你的 Git 提供商（GitHub/GitLab/Bitbucket）</li>
                            <li>授权 Cloudflare 访问你的仓库</li>
                            <li>选择 <code class="bg-gray-100 px-1 rounded">ds-voice-box</code> 仓库</li>
                            <li>点击 <strong>Begin setup</strong></li>
                        </ol>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">3. 配置项目设置</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li><strong>Project name：</strong>可以自定义（如：ds-voice-box）</li>
                            <li><strong>Production branch：</strong>通常为 <code class="bg-gray-100 px-1 rounded">main</code> 或 <code class="bg-gray-100 px-1 rounded">master</code></li>
                            <li><strong>Framework preset：</strong>选择 <code class="bg-gray-100 px-1 rounded">None</code>（本项目无需构建）</li>
                            <li><strong>Build command：</strong>留空</li>
                            <li><strong>Build output directory：</strong>留空或填写 <code class="bg-gray-100 px-1 rounded">/</code></li>
                        </ul>
                        <p class="text-gray-700 mb-4 mt-4">
                            点击 <strong>Save and Deploy</strong> 开始首次部署。
                        </p>
                    </section>

                    <section id="configure-env" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">配置环境变量</h2>
                        <p class="text-gray-700 mb-4">
                            部署完成后，需要配置环境变量。详细配置请参考
                            <a href="/docs/configuration.html" class="text-blue-600 hover:underline">配置指南</a>。
                        </p>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">配置步骤</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>在项目页面，点击 <strong>Settings</strong> 标签</li>
                            <li>在左侧菜单选择 <strong>Variables and Secrets</strong></li>
                            <li>在 <strong>Environment Variables</strong> 部分，点击 <strong>Add variable</strong></li>
                            <li>添加以下环境变量：
                                <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                    <li><code class="bg-gray-100 px-1 rounded">ALIGENIE_NAME</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">ALIGENIE_CONTENT</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">HA_URL</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">HA_TOKEN</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">LOGIN_PATH</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">ADMIN_PASSWORD</code></li>
                                    <li><code class="bg-gray-100 px-1 rounded">KV_BINDING_NAME</code></li>
                                </ul>
                            </li>
                            <li>为每个变量选择应用环境（Production、Preview 或 Both）</li>
                            <li>点击 <strong>Save</strong></li>
                        </ol>
                    </section>

                    <section id="configure-kv" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">配置 KV Namespace</h2>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">1. 创建 KV Namespace</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>在 Cloudflare Dashboard，选择 <strong>Workers & Pages</strong></li>
                            <li>点击 <strong>KV</strong> 标签</li>
                            <li>点击 <strong>Create a namespace</strong></li>
                            <li>输入名称（如：<code class="bg-gray-100 px-1 rounded">INTENTS_KV</code>）</li>
                            <li>点击 <strong>Add</strong></li>
                        </ol>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">2. 绑定到 Pages 项目</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>回到你的 Pages 项目页面</li>
                            <li>进入 <strong>Settings</strong> → <strong>Functions</strong></li>
                            <li>在 <strong>KV Namespace Bindings</strong> 部分，点击 <strong>Add binding</strong></li>
                            <li>填写：
                                <ul class="list-disc list-inside ml-4 mt-2">
                                    <li><strong>Variable name：</strong>与 KV_BINDING_NAME 环境变量的值一致（如：<code class="bg-gray-100 px-1 rounded">INTENTS_KV</code>）</li>
                                    <li><strong>KV namespace：</strong>选择刚才创建的 namespace</li>
                                </ul>
                            </li>
                            <li>点击 <strong>Save</strong></li>
                        </ol>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">3. 设置 KV_BINDING_NAME</h3>
                        <p class="text-gray-700 mb-4">
                            在环境变量中设置 <code class="bg-gray-100 px-1 rounded">KV_BINDING_NAME</code>，
                            值必须与步骤 2 中的 Variable name 完全一致。
                        </p>
                    </section>

                    <section id="custom-domain" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">配置自定义域名（可选）</h2>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>在项目页面，进入 <strong>Custom domains</strong></li>
                            <li>点击 <strong>Set up a custom domain</strong></li>
                            <li>输入你的域名（如：<code class="bg-gray-100 px-1 rounded">voice.yourdomain.com</code>）</li>
                            <li>按照提示配置 DNS 记录</li>
                            <li>等待 DNS 生效（通常几分钟）</li>
                        </ol>
                        <p class="text-gray-700 mb-4 mt-4">
                            配置完成后，你的项目可以通过自定义域名访问，同时也会保留默认的 <code class="bg-gray-100 px-1 rounded">*.pages.dev</code> 域名。
                        </p>
                    </section>

                    <section id="deployment" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">部署流程</h2>
                        <p class="text-gray-700 mb-4">
                            Cloudflare Pages 支持自动部署：
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li><strong>自动部署：</strong>每次推送到主分支会自动触发部署</li>
                            <li><strong>预览部署：</strong>每个 Pull Request 会创建预览部署</li>
                            <li><strong>手动部署：</strong>可以在 Dashboard 中手动触发部署</li>
                        </ul>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">查看部署状态</h3>
                        <ol class="list-decimal list-inside space-y-2 text-gray-700 ml-4">
                            <li>在项目页面，点击 <strong>Deployments</strong> 标签</li>
                            <li>可以看到所有部署历史和状态</li>
                            <li>点击部署可以查看详细日志</li>
                        </ol>
                    </section>

                    <section id="troubleshooting" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">故障排除</h2>
                        
                        <h3 class="text-xl font-semibold text-gray-800 mb-3">部署失败</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>检查构建日志中的错误信息</li>
                            <li>确认项目结构正确（<code class="bg-gray-100 px-1 rounded">functions/</code> 目录存在）</li>
                            <li>检查环境变量是否都已配置</li>
                        </ul>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">Functions 不工作</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>确认 <code class="bg-gray-100 px-1 rounded">functions/</code> 目录结构正确</li>
                            <li>检查函数文件是否有语法错误</li>
                            <li>查看 Functions 日志获取详细错误信息</li>
                        </ul>

                        <h3 class="text-xl font-semibold text-gray-800 mb-3 mt-4">KV 无法访问</h3>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                            <li>确认 KV Namespace 已正确绑定</li>
                            <li>检查 <code class="bg-gray-100 px-1 rounded">KV_BINDING_NAME</code> 环境变量是否正确</li>
                            <li>确认绑定名称与环境变量值完全一致</li>
                        </ul>
                    </section>

                    <section id="resources" class="section mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">参考资源</h2>
                        <ul class="space-y-2 text-gray-700">
                            <li>
                                <a href="https://developers.cloudflare.com/pages/" target="_blank" class="text-blue-600 hover:underline">
                                    Cloudflare Pages 官方文档
                                </a>
                            </li>
                            <li>
                                <a href="https://developers.cloudflare.com/pages/platform/functions/" target="_blank" class="text-blue-600 hover:underline">
                                    Cloudflare Pages Functions 文档
                                </a>
                            </li>
                            <li>
                                <a href="https://developers.cloudflare.com/workers/runtime-apis/kv/" target="_blank" class="text-blue-600 hover:underline">
                                    Cloudflare KV 文档
                                </a>
                            </li>
                        </ul>
                    </section>
                </div>
            </div>
        </main>

        <!-- 右侧段落标题导航 -->
        <aside class="toc-right">
            <div class="bg-white rounded-lg shadow p-4">
                <h3 class="font-bold text-gray-800 mb-4 text-sm">本页导航</h3>
                <nav class="space-y-1 text-sm">
                    <a href="#overview" class="block text-gray-600 hover:text-blue-600">概述</a>
                    <a href="#prerequisites" class="block text-gray-600 hover:text-blue-600">前置要求</a>
                    <a href="#prepare-repo" class="block text-gray-600 hover:text-blue-600">准备 Git 仓库</a>
                    <a href="#create-project" class="block text-gray-600 hover:text-blue-600">创建 Pages 项目</a>
                    <a href="#configure-env" class="block text-gray-600 hover:text-blue-600">配置环境变量</a>
                    <a href="#configure-kv" class="block text-gray-600 hover:text-blue-600">配置 KV Namespace</a>
                    <a href="#custom-domain" class="block text-gray-600 hover:text-blue-600">配置自定义域名</a>
                    <a href="#deployment" class="block text-gray-600 hover:text-blue-600">部署流程</a>
                    <a href="#troubleshooting" class="block text-gray-600 hover:text-blue-600">故障排除</a>
                    <a href="#resources" class="block text-gray-600 hover:text-blue-600">参考资源</a>
                </nav>
            </div>
        </aside>
    </div>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">Home Voice Box - 让智能家居更智能</p>
        </div>
    </footer>
</body>
</html>

